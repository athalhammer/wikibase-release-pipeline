#!/bin/bash

# Ensure the script exits on error
set -e

# Check if we're in a CI environment
if [ "$CI" = "true" ]; then
  echo "Running in CI mode"
  npm ci
  npx nx "$@"
else
  # Explicitly adds the Docker network wbs-dev
  docker network inspect wbs-dev > /dev/null 2>&1 || \
  docker network create wbs-dev > /dev/null

  # Run the Nx command inside the Docker container
  exec docker compose --progress quiet --env-file=test/test-runner.env \
  run --build --rm --service-ports runner -c \
  "npx nx ${*}"
fi
